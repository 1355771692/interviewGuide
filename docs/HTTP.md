(PS：扫描[首页里面的二维码](README.md)进群，分享我自己在看的技术资料给大家，希望和大家一起学习进步！)



#### [1.HTTPS建立连接的过程是怎么样的？](#HTTPS建立连接的过程是怎么样的？)

### HTTPS建立连接的过程是怎么样的？

在发起连接之前，服务器会将自己的公钥发给CA证书机构，CA证书机构会用自己的私钥对服务器的公钥加密，生成CA证书给服务器，服务器存储后供之后建立安全连接使用。

1.客户端发起请求，TCP三次握手，跟服务器建立连接。
2.发送请求将随机数(时间戳+随机数)，sessionID，支持的加密方式发送给服务器
3.服务器接受请求，将随机数，sessionID,挑选的加密方式，CA证书发给客户端，CA证书会包括发布机构，过期时间，公共密钥
4.客户端收到CA证书后，会将证书跟客户端内置的CA证书进行校验，CA证书中会有一个证书机构用自己的私钥对公钥，域名，有效期生成的hash值加密结果，也就是签名，客户端中内置的证书用公钥签名进行解密，看解密后得到的结果跟公钥，域名，有效期的hash值是否一样，这个如果是真实的，然后会看过期时间，域名是否匹配
5.客户端会随机生成一个对称加密的公钥，根据根据CA证书里面的公钥将它加密后发给服务器
6.服务器用自己的私钥解密，得到对称加密的公钥
7.之后就根据对称加密的公钥进行通信

假设没有CA，那么如果服务器返回的包含公钥的包被hack截取，然后hack也生成一对公私钥，他将自己的公钥发给客户端。hack得到客户端数据后，解密，然后再通过服务器的公钥加密发给服务器，这样数据就被hack获取。
有了CA后，客户端根据内置的CA根证书，很容易识别出hack的公钥不合法，或者说hack的证书不合法。



##### HTTP 缓存策略

//优先级 强缓存>协商缓存 cache-control>expires

HTTP 缓存主要分为强缓存和协商缓存
强缓存 浏览器缓存数据库里有缓存数据就不再去向服务器发请求了
expires
header中的 expires保存了一个过期时间，
 如果当前时间小于过期时间，就不去像服务器发请求了，但是是一个绝对时间，
 如果客户端时间修改了，与服务端时间不同步，并且相差较大的话就会有问题。

Cache-Control（优先级高于expires）
可以取多个值，
private 只有客户端可以缓存
public 客户端和代理服务器都可以缓存
no-cache 不能使用强缓存，需要使用对比缓存
no-store 机密内容，不能使用缓存
max-age=11 缓存在多少秒之后失效

对比缓存
需要给服务器发请求，并且带上缓存数据的缓存标识，
让服务端进行对比，如果数据没有更改就只返回header部分，
body为空，状态码是304，浏览器使用缓存数据
如果数据有更改，就返回更新后的数据。

Last-Modified/If-Modified-Since
就是 response header会返回Last-Modified 资源上次的修改时间，
发请求时 request-header会带上If-Modified-Since资源上次修改时间，
服务器判断资源是否有更新

Etag/If-None-Match(优先级高于Last-Modified/If-Modified-Since）
就是 response header会返回Etag 资源的标识，
发请求时 request-header会带上If-Modified-Since资源的标识